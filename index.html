<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BB84 Kid Quest ‚Äî Learn Quantum Key Distribution</title>
  <style>
    :root{
      /* Light minimalist palette */
      --bg: #f6f7fb;
      --card: #ffffff;
      --mutedcard:#fbfbfe;
      --text:#111827;      /* slate-900 */
      --muted:#6b7280;     /* gray-500 */
      --line:#e5e7eb;      /* gray-200 */
      --line2:#eef2f7;     /* very light */
      --shadow: 0 10px 22px rgba(17,24,39,.08);

      --accent:#10b981;    /* emerald-500 */
      --accent2:#2563eb;   /* blue-600 */
      --warn:#f59e0b;      /* amber-500 */
      --danger:#ef4444;    /* red-500 */

      --round: 18px;
      --round2: 14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(900px 450px at 15% 0%, rgba(37,99,235,.10), transparent 60%),
                  radial-gradient(900px 450px at 85% 0%, rgba(16,185,129,.10), transparent 60%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .app{
      width:min(1400px, 100%);
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .app{grid-template-columns:1fr}
    }

    .card{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--round);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    header{
      padding:16px 18px;
      background: linear-gradient(180deg, rgba(37,99,235,.06), transparent 70%);
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    header h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    header p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
      max-width:70ch;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(16,185,129,.10);
      border:1px solid rgba(16,185,129,.25);
      color: #065f46;
      font-size:12px;
      white-space:nowrap;
      height: fit-content;
    }
    .pill b{ color: var(--text); }
    .content{ padding:12px; }

    .board{
      background: var(--mutedcard);
      border-radius: var(--round2);
      border:1px solid var(--line);
      padding:12px;
      min-height:380px;
    }
    .lanes{
      display:grid;
      grid-template-columns: 1fr 1.35fr 1fr;
      gap:12px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .lanes{grid-template-columns:1fr; }
    }

    .lane{
      background: #fff;
      border:1px solid var(--line);
      border-radius: var(--round2);
      padding:12px;
      min-height:310px;
    }
    .lane h2{
      margin:0 0 8px;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .tag{
      font-size:11px;
      color:var(--muted);
      padding:5px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: #fff;
    }

    .character{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:8px;
      padding:10px;
      border-radius: 14px;
      background: #fff;
      border:1px solid var(--line);
    }
    .avatar{
      width:40px;
      height:40px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      font-size:20px;
      background: rgba(16,185,129,.10);
      border:1px solid rgba(16,185,129,.25);
      flex:0 0 auto;
    }
    .avatar.bob{
      background: rgba(37,99,235,.10);
      border:1px solid rgba(37,99,235,.25);
    }
    .character .meta{display:flex; flex-direction:column; gap:2px;}
    .character .meta b{font-size:13px;}
    .character .meta span{font-size:12px; color:var(--muted);}

    .controls{ margin-top:10px; display:grid; gap:10px; }

    .row{
      display:grid;
      grid-auto-flow: column;
      grid-auto-columns: 1fr;
      gap:10px;
      align-items:stretch;
      margin-top:2px;
    }

    button{
      cursor:pointer;
      border:none;
      border-radius: 12px;
      padding:10px 12px;
      min-height: 42px;
      font-weight:650;
      font-size:13px;
      color: var(--text);
      background: #fff;
      border:1px solid var(--line);
      transition: transform .05s ease, box-shadow .18s ease, background .18s ease;
      user-select:none;
      width:100%;
    }
    button:hover{ box-shadow: 0 6px 14px rgba(17,24,39,.08); }
    button:active{ transform: translateY(1px); box-shadow:none; }

    button.primary{
      border-color: rgba(16,185,129,.35);
      background: rgba(16,185,129,.10);
    }
    button.blue{
      border-color: rgba(37,99,235,.35);
      background: rgba(37,99,235,.08);
    }
    button.warn{
      border-color: rgba(245,158,11,.40);
      background: rgba(245,158,11,.10);
    }
    button.danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.10);
    }
    button:disabled{
      opacity:.45;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }

    .bigChoice{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .choice{
      padding:12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: #fff;
      display:grid;
      gap:6px;
      text-align:left;
    }
    .choice b{font-size:14px}
    .choice span{font-size:12px; color:var(--muted); line-height:1.35}
    .choice .icon{font-size:18px; opacity:.9}
    .choice.selected{
      outline: 2px solid rgba(16,185,129,.55);
      background: rgba(16,185,129,.07);
      border-color: rgba(16,185,129,.25);
    }

    /* CHANNEL */
    .channel{ height:100%; display:flex; flex-direction:column; gap:10px; }
    .labels{ display:flex; justify-content:space-between; font-size:12px; color:var(--muted); }

    .bubbleSlot{
      min-height: 86px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }
    .bubble{
      width:min(640px, 100%);
      padding:10px 12px;
      border-radius: 14px;
      background: #fff;
      border:1px solid var(--line);
      box-shadow: 0 10px 22px rgba(17,24,39,.08);
      display:grid;
      gap:6px;

      opacity:0;
      transform: translateY(-4px) scale(.99);
      transition: opacity .18s ease, transform .18s ease;
    }
    .bubble.show{
      opacity:1;
      transform: translateY(0) scale(1);
    }
    .bubble .title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight:750; font-size:13px;
    }
    .bubble .text{
      font-size:12px;
      color: var(--muted);
      line-height:1.45;
    }

    .pipe{
      position:relative;
      flex:1;
      border-radius: 14px;
      border:1px dashed #d7dce4;
      background: linear-gradient(180deg, rgba(37,99,235,.05), rgba(16,185,129,.04));
      overflow:hidden;
      min-height:240px;
    }
    .pipe:before{
      content:"";
      position:absolute;
      inset:0;
      background: repeating-linear-gradient(
        90deg,
        rgba(17,24,39,.03) 0px,
        rgba(17,24,39,.03) 10px,
        transparent 10px,
        transparent 24px
      );
      opacity:.55;
      pointer-events:none;
    }

    .photon{
      position:absolute;
      top:60%;
      left:12%;
      transform: translate(-50%, -50%);
      width:44px;
      height:44px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      font-size:18px;
      background: rgba(16,185,129,.20);
      border:1px solid rgba(16,185,129,.35);
      opacity:0;
      z-index: 2;
    }
    .photon.blue{
      background: rgba(37,99,235,.15);
      border:1px solid rgba(37,99,235,.35);
    }
    .photon.show{ opacity:1; transition: opacity .22s ease; }

    @keyframes fly {
      0%   { left: 12%; transform: translate(-50%,-50%) scale(1); }
      100% { left: 88%; transform: translate(-50%,-50%) scale(1.02); }
    }
    .photon.fly{ animation: fly 1.25s ease-in-out forwards; }

    /* Side */
    .side{ display:grid; gap:14px; }
    .panel{ padding:14px; }
    .panel h3{ margin:0 0 8px; font-size:14px; }

    .status{ display:grid; gap:10px; }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .stat{
      background: #fff;
      border:1px solid var(--line);
      border-radius: 14px;
      padding:10px;
      display:grid;
      gap:4px;
    }
    .stat span{font-size:11px; color:var(--muted)}
    .stat b{font-size:14px}

    .keyline{ display:flex; flex-wrap:wrap; gap:6px; margin-top:4px; }
    .bit{
      width:26px;
      height:26px;
      border-radius: 10px;
      display:grid;
      place-items:center;
      font-weight:800;
      font-size:13px;
      border:1px solid var(--line);
      background: #fff;
      color: var(--text);
    }
    .bit.keep{
      border-color: rgba(16,185,129,.35);
      background: rgba(16,185,129,.12);
      color: #065f46;
    }

    .footerHint{
      color: var(--muted);
      font-size:12px;
      padding:0 2px;
      line-height:1.45;
    }

    @keyframes twinkle {
      0%{opacity:.0; transform: translateY(4px) scale(.95);}
      45%{opacity:1; transform: translateY(0) scale(1);}
      100%{opacity:0; transform: translateY(-6px) scale(.98);}
    }
    .sparkle{
      position:absolute;
      pointer-events:none;
      font-size:14px;
      animation: twinkle .7s ease-out forwards;
      opacity:0;
      z-index: 4;
    }
  </style>
</head>

<body>
  <div class="app">
    <section class="card">
      <header>
        <div>
          <h1>BB84 Kid Quest üß™üîë</h1>
          <p>
            You are <b>Alice</b>. Pick a secret bit (0/1) and a ‚Äúmagic lens‚Äù (basis ‚ûï or ‚úñ).
            Send a photon to <b>Bob</b>, who measures with a random lens.
            If your lenses match, you keep that bit for your shared secret key!
          </p>
        </div>
        <div class="pill"><span>Goal:</span> <b>Build a key</b></div>
      </header>

      <div class="content">
        <div class="board">
          <div class="lanes">
            <!-- ALICE -->
            <div class="lane" id="laneAlice">
              <h2>Alice (You) üê∞ <span class="tag" id="aliceStepTag">Step 1/4</span></h2>

              <div class="character">
                <div class="avatar">üê∞</div>
                <div class="meta">
                  <b>Pick a bit + basis</b>
                  <span>Bit is 0 or 1. Basis is ‚ûï or ‚úñ.</span>
                </div>
              </div>

              <div class="controls">
                <div class="bigChoice" id="bitChoices">
                  <div class="choice" data-bit="0" tabindex="0">
                    <div class="icon">0Ô∏è‚É£</div><b>Bit = 0</b><span>Like ‚Äúoff‚Äù / ‚Äúno‚Äù.</span>
                  </div>
                  <div class="choice" data-bit="1" tabindex="0">
                    <div class="icon">1Ô∏è‚É£</div><b>Bit = 1</b><span>Like ‚Äúon‚Äù / ‚Äúyes‚Äù.</span>
                  </div>
                </div>

                <div class="bigChoice" id="basisChoices">
                  <div class="choice" data-basis="PLUS" tabindex="0">
                    <div class="icon">‚ûï</div><b>Basis = ‚ûï</b><span>‚ÄúStraight‚Äù lens.</span>
                  </div>
                  <div class="choice" data-basis="CROSS" tabindex="0">
                    <div class="icon">‚úñ</div><b>Basis = ‚úñ</b><span>‚ÄúDiagonal‚Äù lens.</span>
                  </div>
                </div>

                <div class="row">
                  <button class="primary" id="btnEncode" disabled>Encode Photon ‚ú®</button>
                  <button class="warn" id="btnResetRound">Reset Round ‚Ü©Ô∏è</button>
                </div>

                <button class="primary" id="btnSend" disabled>Send Through Channel üöÄ</button>
              </div>

              <div class="footerHint">Tip: Wrong basis (lens) ‚Üí random measurement.</div>
            </div>

            <!-- CHANNEL -->
            <div class="lane">
              <h2>Quantum Channel üåå <span class="tag">Animated</span></h2>

              <div class="channel">
                <div class="labels"><span>from Alice</span><span>to Bob</span></div>

                <div class="bubbleSlot">
                  <div class="bubble" id="bubble">
                    <div class="title">
                      <span id="bubbleTitle">Ready!</span>
                      <span class="tag">BB84</span>
                    </div>
                    <div class="text" id="bubbleText">Pick a bit and a basis, then encode and send.</div>
                  </div>
                </div>

                <div class="pipe" id="pipe">
                  <div class="photon" id="photon" aria-label="photon">‚öõÔ∏è</div>
                </div>

                <div class="row">
                  <button class="blue" id="btnRevealBases" disabled>Reveal Bases üó£Ô∏è</button>
                  <button class="blue" id="btnNextRound" disabled>Next Photon ‚û°Ô∏è</button>
                </div>
              </div>
            </div>

            <!-- BOB -->
            <div class="lane" id="laneBob">
              <h2>Bob ü§ñ <span class="tag" id="bobStepTag">Waiting‚Ä¶</span></h2>

              <div class="character">
                <div class="avatar bob">ü§ñ</div>
                <div class="meta">
                  <b>Bob measures randomly</b>
                  <span>He picks ‚ûï or ‚úñ and measures.</span>
                </div>
              </div>

              <div class="controls">
                <div class="stat"><span>Bob's chosen basis</span><b id="bobBasis">‚Äî</b></div>
                <div class="stat"><span>Bob's measured bit</span><b id="bobBit">‚Äî</b></div>
                <button class="blue" id="btnMeasure" disabled>Bob Measures üéõÔ∏è</button>
              </div>

              <div class="footerHint">Fun fact: Wrong basis ‚Üí random result üé≤</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SIDE -->
    <aside class="side">
      <section class="card panel">
        <h3>Scoreboard</h3>
        <div class="status">
          <div class="grid2">
            <div class="stat"><span>Photons sent</span><b id="sentCount">0</b></div>
            <div class="stat"><span>Kept (matching bases)</span><b id="keptCount">0</b></div>
          </div>

          <div class="stat">
            <span>Sifted key (kept bits)</span>
            <div class="keyline" id="keyBits"></div>
          </div>

          <div class="footerHint">Keep bits only when bases match (‚ûï‚ûï or ‚úñ‚úñ).</div>
        </div>
      </section>

      <section class="card panel">
        <h3>Big Idea</h3>
        <div class="footerHint">
          Alice encodes using a secret basis. Bob measures with a random basis.
          Later they compare bases (not bits). Matching bases become shared secret bits.
        </div>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <button class="danger" id="btnResetAll">Reset Everything</button>
        </div>
      </section>
    </aside>
  </div>

  <script>
    const state = {
      phase: "PICK",
      aliceBit: null,
      aliceBasis: null,
      bobBasis: null,
      bobBit: null,
      sent: 0,
      kept: 0,
      key: []
    };

    const bitChoices = document.getElementById("bitChoices");
    const basisChoices = document.getElementById("basisChoices");
    const btnEncode = document.getElementById("btnEncode");
    const btnSend = document.getElementById("btnSend");
    const btnMeasure = document.getElementById("btnMeasure");
    const btnRevealBases = document.getElementById("btnRevealBases");
    const btnNextRound = document.getElementById("btnNextRound");
    const btnResetRound = document.getElementById("btnResetRound");
    const btnResetAll = document.getElementById("btnResetAll");

    const aliceStepTag = document.getElementById("aliceStepTag");
    const bobStepTag = document.getElementById("bobStepTag");

    const photon = document.getElementById("photon");
    const pipe = document.getElementById("pipe");

    const bubble = document.getElementById("bubble");
    const bubbleTitle = document.getElementById("bubbleTitle");
    const bubbleText = document.getElementById("bubbleText");

    const bobBasisEl = document.getElementById("bobBasis");
    const bobBitEl = document.getElementById("bobBit");

    const sentCount = document.getElementById("sentCount");
    const keptCount = document.getElementById("keptCount");
    const keyBits = document.getElementById("keyBits");

    const randBit = () => (Math.random() < 0.5 ? 0 : 1);
    const randBasis = () => (Math.random() < 0.5 ? "PLUS" : "CROSS");
    const basisIcon = (b) => (b === "PLUS" ? "‚ûï" : b === "CROSS" ? "‚úñ" : "‚Äî");

    function setBubble(title, text){
      bubbleTitle.textContent = title;
      bubbleText.textContent = text;
      bubble.classList.add("show");
      clearTimeout(setBubble._t);
      setBubble._t = setTimeout(() => bubble.classList.remove("show"), 6000);
    }

    function sparkle(x, y, char="‚ú®"){
      const s = document.createElement("div");
      s.className = "sparkle";
      s.textContent = char;
      s.style.left = `${x}px`;
      s.style.top = `${y}px`;
      pipe.appendChild(s);
      setTimeout(() => s.remove(), 800);
    }

    function updateUI(){
      if (state.phase === "PICK"){
        aliceStepTag.textContent = "Step 1/4";
        bobStepTag.textContent = "Waiting‚Ä¶";
      } else if (state.phase === "ENCODED"){
        aliceStepTag.textContent = "Step 2/4";
        bobStepTag.textContent = "Waiting‚Ä¶";
      } else if (state.phase === "SENT"){
        aliceStepTag.textContent = "Sent!";
        bobStepTag.textContent = "Step 3/4";
      } else if (state.phase === "MEASURED"){
        aliceStepTag.textContent = "Sent!";
        bobStepTag.textContent = "Measured!";
      } else if (state.phase === "REVEALED"){
        aliceStepTag.textContent = "Step 4/4";
        bobStepTag.textContent = "Step 4/4";
      }

      const hasPick = state.aliceBit !== null && state.aliceBasis !== null;
      btnEncode.disabled = !(state.phase === "PICK" && hasPick);
      btnSend.disabled = !(state.phase === "ENCODED");
      btnMeasure.disabled = !(state.phase === "SENT");
      btnRevealBases.disabled = !(state.phase === "MEASURED");
      btnNextRound.disabled = !(state.phase === "REVEALED");

      bobBasisEl.textContent = basisIcon(state.bobBasis);
      bobBitEl.textContent = (state.bobBit === null ? "‚Äî" : String(state.bobBit));

      sentCount.textContent = String(state.sent);
      keptCount.textContent = String(state.kept);

      keyBits.innerHTML = "";
      state.key.forEach((b) => {
        const el = document.createElement("div");
        el.className = "bit keep";
        el.textContent = b;
        keyBits.appendChild(el);
      });
      if(state.key.length === 0){
        const ghost = document.createElement("div");
        ghost.className = "bit";
        ghost.style.opacity = ".6";
        ghost.textContent = "‚Äî";
        keyBits.appendChild(ghost);
      }
    }

    function clearSelections(container){
      [...container.querySelectorAll(".choice")].forEach(c => c.classList.remove("selected"));
    }

    function resetRound(){
      state.phase = "PICK";
      state.aliceBit = null;
      state.aliceBasis = null;
      state.bobBasis = null;
      state.bobBit = null;

      clearSelections(bitChoices);
      clearSelections(basisChoices);

      photon.className = "photon";
      photon.style.left = "12%";
      photon.style.opacity = "0";

      updateUI();
    }

    function resetAll(){
      state.sent = 0;
      state.kept = 0;
      state.key = [];
      resetRound();
      setBubble("Clean Slate", "Everything reset. Let's build a new key!");
    }

    function selectBit(bit){
      state.aliceBit = bit;
      clearSelections(bitChoices);
      bitChoices.querySelector(`[data-bit="${bit}"]`).classList.add("selected");
      setBubble("Bit chosen", `Alice picked bit ${bit}. Now pick a basis (‚ûï or ‚úñ).`);
      updateUI();
    }

    function selectBasis(basis){
      state.aliceBasis = basis;
      clearSelections(basisChoices);
      basisChoices.querySelector(`[data-basis="${basis}"]`).classList.add("selected");
      setBubble("Basis chosen", `Alice picked basis ${basisIcon(basis)}. Now encode!`);
      updateUI();
    }

    bitChoices.addEventListener("click", (e) => {
      const card = e.target.closest(".choice");
      if(!card) return;
      selectBit(Number(card.dataset.bit));
    });
    basisChoices.addEventListener("click", (e) => {
      const card = e.target.closest(".choice");
      if(!card) return;
      selectBasis(card.dataset.basis);
    });

    function handleEnterSelect(container, handler){
      container.addEventListener("keydown", (e) => {
        if(e.key !== "Enter") return;
        const card = e.target.closest(".choice");
        if(!card) return;
        handler(card);
      });
    }
    handleEnterSelect(bitChoices, (card) => selectBit(Number(card.dataset.bit)));
    handleEnterSelect(basisChoices, (card) => selectBasis(card.dataset.basis));

    btnEncode.addEventListener("click", () => {
      state.phase = "ENCODED";

      photon.className = "photon show " + (state.aliceBasis === "CROSS" ? "blue" : "");
      photon.textContent = (state.aliceBasis === "PLUS")
        ? (state.aliceBit === 0 ? "‚¨áÔ∏è" : "‚û°Ô∏è")
        : (state.aliceBit === 0 ? "‚ÜôÔ∏è" : "‚ÜóÔ∏è");

      setBubble("Encoded", "Photon now carries your bit using your secret basis.");
      updateUI();

      const r = pipe.getBoundingClientRect();
      sparkle(r.width * 0.18, r.height * 0.62, "‚ú®");
    });

    btnSend.addEventListener("click", async () => {
      state.phase = "SENT";
      state.sent += 1;

      setBubble("Sending", "Photon is traveling through the quantum channel‚Ä¶");
      updateUI();

      photon.classList.add("fly");
      photon.style.opacity = "1";

      await wait(1300);

      photon.classList.remove("fly");
      photon.style.left = "88%";

      setBubble("Arrived", "Photon reached Bob. Now Bob measures with a random basis.");
      updateUI();
    });

    btnMeasure.addEventListener("click", () => {
      state.bobBasis = randBasis();
      const match = (state.bobBasis === state.aliceBasis);
      state.bobBit = match ? state.aliceBit : randBit();

      state.phase = "MEASURED";

      setBubble("Measured",
        match
          ? "Bases match, so Bob gets the correct bit."
          : "Bases differ, so the result becomes random."
      );

      const r = pipe.getBoundingClientRect();
      sparkle(r.width * 0.85, r.height * 0.62, match ? "‚úì" : "üé≤");

      updateUI();
    });

    btnRevealBases.addEventListener("click", () => {
      state.phase = "REVEALED";

      const match = (state.bobBasis === state.aliceBasis);
      if (match){
        state.kept += 1;
        state.key.push(String(state.aliceBit));
      }

      setBubble("Reveal bases",
        match
          ? "Bases match. Keep this bit for your secret key."
          : "Bases don‚Äôt match. Discard this round."
      );

      updateUI();
    });

    btnNextRound.addEventListener("click", () => {
      resetRound();
      setBubble("Next photon", "Pick a new bit and basis.");
    });

    btnResetRound.addEventListener("click", () => {
      resetRound();
      setBubble("Round reset", "Pick a bit and basis again.");
    });

    btnResetAll.addEventListener("click", resetAll);

    function wait(ms){ return new Promise(res => setTimeout(res, ms)); }

    resetRound();
    setBubble("Welcome", "Pick a bit (0/1) and a basis (‚ûï/‚úñ), then encode.");
    updateUI();
  </script>
</body>
</html>
